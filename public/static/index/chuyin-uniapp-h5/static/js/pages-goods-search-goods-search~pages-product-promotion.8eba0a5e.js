(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-goods-search-goods-search~pages-product-promotion"],{"02fe":function(e,t,n){"use strict";n.r(t);var s=n("dd8f"),i=n.n(s);for(var a in s)"default"!==a&&function(e){n.d(t,e,(function(){return s[e]}))}(a);t["default"]=i.a},"1b29":function(e,t,n){"use strict";n.r(t);var s=n("b535"),i=n("02fe");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("1e81");var o,r=n("f0c5"),c=Object(r["a"])(i["default"],s["b"],s["c"],!1,null,"0d5bf16a",null,!1,s["a"],o);t["default"]=c.exports},"1e81":function(e,t,n){"use strict";var s=n("94a8"),i=n.n(s);i.a},"2ef6":function(e,t,n){"use strict";var s=n("4ea4");n("c740"),n("a15b"),n("d81d"),n("a434"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var i=s(n("1da1")),a=s(n("ade3")),o=s(n("5530")),r=n("2f62"),c=n("b116"),l=s(n("9fc0")),u=s(n("10b9")),d=s(n("977e")),f={components:{},mixins:[u.default],props:{},watch:{specClass:function(e){"hide"==e&&(this.proInfo={},this.buy_min_number=1,this.buy_max_number=1,this.inventory=1,this.stock=1,this.common_site_type="",this.is_consistent="",this.nav_submit_text="",this.options=[],this.sel_vaild_sks=[],this.selected_skus=[],this.selected_skus_info={})}},computed:(0,o.default)((0,o.default)({},(0,r.mapGetters)(["mallToken","cache_config_info_key","cache_user_login_key","cache_shop_user_info_key"])),{},{sku_selected:function(){var e=this.selected_skus_info.price?this.selected_skus_info.price:this.proInfo.price,t=this.selected_skus_info.original_price?this.selected_skus_info.original_price:this.proInfo.original_price,n=this.selected_skus.map((function(e){return e.type+":"+e.value}));return n=n.join("；"),{price:e,spec:n||"",original_price:t}},isBtnValid:function(){var e=this.selected_skus.length!=this.options.length||this.isbtnLoading||0==this.inventory;return e},authPassed:function(){var e=this.cache_shop_user_info_key||{},t=e.is_mandatory_bind_mobile,n=e.mobile;return this.cache_user_login_key&&this.cache_shop_user_info_key&&(0==t||1==t&&!(0,c.isEmpty)(n))}}),data:function(){var e;return e={specClass:"none",options:[],isbtnLoading:!1,stock:1,proInfo:{}},(0,a.default)(e,"options",[]),(0,a.default)(e,"buy_min_number",1),(0,a.default)(e,"buy_max_number",1),(0,a.default)(e,"inventory",1),(0,a.default)(e,"stock",1),(0,a.default)(e,"common_site_type",""),(0,a.default)(e,"is_consistent",""),(0,a.default)(e,"sel_vaild_sks",[]),(0,a.default)(e,"selected_skus",[]),(0,a.default)(e,"selected_skus_info",{}),(0,a.default)(e,"nav_submit_text",""),(0,a.default)(e,"selectedSku",{skuPromotion:{}}),(0,a.default)(e,"goods_spec_base_images",""),e},methods:{toggleSpec:function(){var e=this;"show"===this.specClass?(this.specClass="hide",setTimeout((function(){e.specClass="none"}),250)):"none"===this.specClass&&(this.specClass="show")},initFun:function(e){var t=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:s=e.id,t.initLoadingFn((0,i.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.product_id=s,e.next=3,t.getProdInfo(s);case 3:setTimeout((function(){t.specClass="show"}),100);case 4:case"end":return e.stop()}}),e)}))));case 2:case"end":return n.stop()}}),n)})))()},getProdInfo:function(e){var t=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.loadingFn((0,l.default)("/api/goods/detail","POST",{goods_id:e}));case 2:s=n.sent,i=s.data,t.proInfo=i.goods,t.goods_spec_base_images=i.goods&&i.goods.images||"",t.buy_min_number=new d.default(t.proInfo["buy_min_number"]||1).toNumber(),t.buy_max_number=new d.default(t.proInfo["buy_max_number"]||1).toNumber(),t.inventory=new d.default(t.proInfo["inventory"]||1).toNumber(),t.stock=new d.default(t.buy_min_number).toNumber(),t.common_site_type=i.common_site_type,t.is_consistent=i.is_goods_site_type_consistent,t.nav_submit_text=i.nav_submit_text,t.options=i.goods&&i.goods.specifications.choose||[],t.options.length>0&&t.$set(t.sel_vaild_sks,0,t.options[0].value.map((function(e){return e.name})));case 15:case"end":return n.stop()}}),n)})))()},stopPrevent:function(){},skuChange:function(e,t,n){var s=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var i,a,o,r,u,d,f,p,v;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i={type:e.name,value:t.name,id:e.id},a=s.selected_skus.findIndex((function(t){return e.id==t.id})),s.selected_skus.length>0?(o=s.selected_skus.length,-1==a?s.selected_skus.push(i):a+1<o?s.selected_skus.splice(a,o-a,i):s.selected_skus.splice(a,1,i)):s.selected_skus.push(i),r=s.selected_skus.map((function(e){return{type:e.type,value:e.value}})),t&&!(0,c.isEmpty)(t.images)&&(s.goods_spec_base_images=t.images),s.selected_skus.length!=s.options.length){n.next=13;break}return n.next=8,s.loadingFn((0,l.default)("/api/goods/specdetail","POST",{id:e.goods_id,spec:JSON.stringify(r)}));case 8:u=n.sent,d=u.data,s.selected_skus_info=d,n.next=19;break;case 13:return s.selected_skus_info.price&&(s.selected_skus_info={}),n.next=16,s.loadingFn((0,l.default)("/api/goods/spectype","POST",{id:e.goods_id,spec:JSON.stringify(r)}));case 16:f=n.sent,p=f.data,p.length>0&&(v=s.sel_vaild_sks.length,-1==a?s.sel_vaild_sks.push(p):a+1<v?s.sel_vaild_sks.splice(a+1,v-1-a,p):s.sel_vaild_sks.splice(a+1,1,p));case 19:case"end":return n.stop()}}),n)})))()},imgPreview:function(){uni.previewImage({current:0,urls:[this.goods_spec_base_images]})},phoneCall:function(){this.$app.phoneCall(this.cache_config_info_key.config.common_app_customer_service_tel)},addChart:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=e.selected_skus.map((function(e){return{type:e.type,value:e.value}})),s={goods_id:e.product_id,spec:JSON.stringify(n),stock:e.stock},e.isbtnLoading=!0,t.next=6,e.loadingFn((0,l.default)("/api/cart/save","POST",s));case 6:i=t.sent,i.data,e.toggleSpec(),e.$api.msg("加入购物车成功",2e3,!1,"success"),e.isbtnLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),e.isbtnLoading=!1;case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},buy:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.authPassed){t.next=3;break}throw{code:-400,msg:"登录已失效，请重新登录"};case 3:return t.next=5,(0,l.default)("/api/user/center","POST",{},!0);case 5:n=t.sent,n.data,s=e.selected_skus.map((function(e){return{type:e.type,value:e.value}})),i={buy_type:"goods",goods_id:e.product_id,stock:e.stock,spec:JSON.stringify(s)},uni.navigateTo({url:"/pages/order/createOrder?data="+JSON.stringify(i)}),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),e.isbtnLoading=!1,-400==t.t0.code&&(uni.showToast({title:t.t0.msg,icon:"none",duration:1500}),setTimeout((function(){e.$store.dispatch("loginKeyAction",""),e.$app.user_login((function(){uni.showToast({title:"登录成功！",icon:"none",duration:1500})}))}),1e3));case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}};t.default=f},"94a8":function(e,t,n){var s=n("c539");"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=n("4f06").default;i("1ecce677",s,!0,{sourceMap:!1,shadowMode:!1})},b535:function(e,t,n){"use strict";var s;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{ref:"youScroll",staticClass:"you-scroll"},[n("v-uni-view",{staticClass:"pullDown",style:{transform:"translateY("+e.translateY+"px)",transition:e.isDown?"0s":"0.3s"}},[e._t("pullDown",[n("span",[1==e.pullDownStatus?[e._v(e._s(e.downPullToRefresh))]:e._e(),2==e.pullDownStatus?[e._v(e._s(e.downReleaseToRefresh))]:e._e(),3==e.pullDownStatus?[e._v(e._s(e.downRefreshing))]:e._e()],2)])],2),n("v-uni-scroll-view",{ref:"youScrollInner",staticClass:"you-scroll-inner",style:{transform:"translateY("+e.translateY+"px)",transition:e.isDown?"0s":"transform 0.3s"},attrs:{"scroll-y":!0},on:{touchstart:function(t){arguments[0]=t=e.$handleEvent(t),e.startFn.apply(void 0,arguments)},touchmove:function(t){arguments[0]=t=e.$handleEvent(t),e.moveFn.apply(void 0,arguments)},touchend:function(t){arguments[0]=t=e.$handleEvent(t),e.endFn.apply(void 0,arguments)},touchcancel:function(t){arguments[0]=t=e.$handleEvent(t),e.endFn.apply(void 0,arguments)},scroll:function(t){arguments[0]=t=e.$handleEvent(t),e.scroll.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"you-scroll-content"},[e._t("default")],2)],1)],1)},a=[]},c539:function(e,t,n){var s=n("24fb");t=s(!1),t.push([e.i,".you-scroll[data-v-0d5bf16a]{width:100%;height:100%;overflow:hidden;position:relative\n\t/* background-color: #eee; */}.you-scroll .pullDown[data-v-0d5bf16a]{width:100%;height:40px;line-height:50px;text-align:center;font-size:14px;overflow:hidden;-webkit-transform:translateY(-100%);transform:translateY(-100%);position:absolute;top:-40px;left:0;color:#999}.you-scroll .pullDown .down-icon[data-v-0d5bf16a]{width:40px;height:32px;display:inline-block;vertical-align:middle}.you-scroll .pullDown .animate[data-v-0d5bf16a]{-webkit-animation:scaleIcon-data-v-0d5bf16a 1s infinite linear;-moz-animation:scaleIcon-data-v-0d5bf16a 1s infinite linear;-ms-animation:scaleIcon-data-v-0d5bf16a 1s infinite linear;animation:scaleIcon-data-v-0d5bf16a 1s infinite linear}.you-scroll .pullDown span[data-v-0d5bf16a]{white-space:nowrap;overflow:hidden;display:inline-block;vertical-align:middle}.you-scroll .you-scroll-inner[data-v-0d5bf16a]{width:100%;height:100%;overflow:hidden;position:relative}.you-scroll-content[data-v-0d5bf16a]{overflow:hidden}@-webkit-keyframes scaleIcon-data-v-0d5bf16a{0%{-webkit-transform:scaleY(1);transform:scaleY(1)}40%{-webkit-transform:scaleY(.8);transform:scaleY(.8)}80%{-webkit-transform:scaleY(.9);transform:scaleY(.9)}100%{-webkit-transform:scaleY(1);transform:scaleY(1)}}@-moz-keyframes scaleIcon-data-v-0d5bf16a{0%{transform:scaleY(1)}40%{transform:scaleY(.8)}80%{transform:scaleY(.9)}100%{transform:scaleY(1)}}@-ms-keyframes scaleIcon-data-v-0d5bf16a{0%{transform:scaleY(1)}40%{transform:scaleY(.8)}80%{transform:scaleY(.9)}100%{transform:scaleY(1)}}@keyframes scaleIcon-data-v-0d5bf16a{0%{-webkit-transform:scaleY(1);transform:scaleY(1)}40%{-webkit-transform:scaleY(.8);transform:scaleY(.8)}80%{-webkit-transform:scaleY(.9);transform:scaleY(.9)}100%{-webkit-transform:scaleY(1);transform:scaleY(1)}}",""]),e.exports=t},d344:function(e,t,n){"use strict";n.r(t);var s=n("d350"),i=n("d9c6");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);var o,r=n("f0c5"),c=Object(r["a"])(i["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);t["default"]=c.exports},d350:function(e,t,n){"use strict";var s;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"popup spec",class:e.specClass,on:{touchmove:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.stopPrevent.apply(void 0,arguments)},click:function(t){arguments[0]=t=e.$handleEvent(t),e.toggleSpec.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"mask"}),n("v-uni-view",{staticClass:"layer attr-content",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.stopPrevent.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"closePoup"},[n("v-uni-text"),n("v-uni-text",{staticClass:"iconfont icon-guanbi1",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.toggleSpec.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"prompSpec"},[n("v-uni-view",{staticClass:"prop-info"},[n("v-uni-view",{staticClass:"pro-img"},[n("v-uni-image",{staticClass:"loaded",attrs:{src:e.goods_spec_base_images,mode:"aspectFit"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.imgPreview.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"flex1 moreInfo"},[n("v-uni-text",{staticClass:"money"},[n("i",{staticClass:"curry"},[e._v(e._s(e.cache_config_info_key.currency_symbol))]),e._v(e._s(e.sku_selected.price))]),e.selected_skus&&e.selected_skus.length?n("v-uni-text",{staticClass:"speced"},[e._v("已选："+e._s(e.sku_selected.spec))]):e._e()],1)],1),n("v-uni-scroll-view",{staticClass:"promp-spec-content",attrs:{"scroll-y":!0,"scroll-with-animation":!0,"enable-flex":"true"}},[n("v-uni-view",{staticClass:"promp-spec"},[e._l(e.options,(function(t,s){return n("v-uni-view",{key:s,staticClass:"promp-specOption"},[n("v-uni-text",{staticClass:"promp-cateName"},[e._v(e._s(t.name))]),n("v-uni-view",{staticClass:"promp-specs"},e._l(t.value,(function(i,a){return n("v-uni-text",{key:a,staticClass:"promp-cname",class:{active:e.selected_skus[s]&&e.selected_skus[s]["value"]==i["name"],disabled:!e.sel_vaild_sks[s]||e.sel_vaild_sks[s]&&-1==(e.sel_vaild_sks[s]||[]).indexOf(i["name"])},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.skuChange(t,i,a)}}},[e._v(e._s(i["name"]))])})),1)],1)})),n("v-uni-view",{staticClass:"promp-specOption"},[n("v-uni-text",{staticClass:"promp-cateName"},[e._v("数量")]),n("v-uni-view",{staticClass:"promp-count"},[n("v-uni-text",{staticClass:"promp-commBtn",class:e.stock<=e.buy_min_number?"disabled":"",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stock--}}},[n("v-uni-text",{staticClass:"iconfont icon-jian"})],1),n("v-uni-text",{staticClass:"promp-nowCount"},[e._v(e._s(e.stock))]),n("v-uni-text",{staticClass:"promp-commBtn",class:e.stock>=e.inventory||0!=e.buy_max_number&&e.stock>=e.buy_max_number?"disabled":"",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stock++}}},[n("v-uni-text",{staticClass:"iconfont icon-jia"})],1)],1)],1)],2)],1)],1),n("v-uni-view",{staticClass:"footAction"},[1==e.common_site_type?[n("v-uni-button",{staticClass:"btn2 flex1",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.phoneCall.apply(void 0,arguments)}}},[e._v(e._s(e.nav_submit_text))])]:e._e(),1!=e.common_site_type?[1==e.is_consistent?n("v-uni-button",{staticClass:"btn1 flex1",class:{disabled:e.isBtnValid},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addChart.apply(void 0,arguments)}}},[e._v("加入购物车")]):e._e(),n("v-uni-button",{staticClass:"btn2 flex1",class:{disabled:e.isBtnValid},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.buy.apply(void 0,arguments)}}},[e._v(e._s(e.nav_submit_text))])]:e._e()],2)],1)],1)},a=[]},d9c6:function(e,t,n){"use strict";n.r(t);var s=n("2ef6"),i=n.n(s);for(var a in s)"default"!==a&&function(e){n.d(t,e,(function(){return s[e]}))}(a);t["default"]=i.a},dd8f:function(e,t,n){"use strict";n("a9e3"),n("ac1f"),n("466d"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={data:function(){return{scrollTop:0,sPageY:0,mPageY:0,ePageY:0,translateY:0,pullDownStatus:1,isDown:!1}},props:{pullDownDistance:{type:Number,default:50},reachBottomDistance:{type:Number,default:30},downPullToRefresh:{type:String,default:"下拉刷新"},downReleaseToRefresh:{type:String,default:"松开刷新"},downRefreshing:{type:String,default:"刷新中…"}},methods:{startFn:function(e){this.isDown=!0,this.sPageY=e.changedTouches[0].pageY,this.pointY=this.translateY},moveFn:function(e){var t=this,n=uni.createSelectorQuery().in(this).select(".you-scroll-inner");n.fields({size:!0,scrollOffset:!0},(function(n){if(t.scrollTop=n.scrollTop,t.mPageY=e.changedTouches[0].pageY,t.scrollTop<=0){var s=(t.mPageY-t.sPageY)/2+t.pointY;t.translateY=s<0?0:s,3!=t.pullDownStatus&&(t.translateY<t.pullDownDistance?t.pullDownStatus=1:t.translateY>=t.pullDownDistance&&(t.pullDownStatus=2))}})).exec()},endFn:function(e){var t=this;this.isDown=!1,this.ePageY=e.changedTouches[0].pageY,setTimeout((function(){t.translateY=t.translateY>=t.pullDownDistance?t.pullDownDistance:0,2==t.pullDownStatus&&(t.pullDownStatus=3,t.$emit("onPullDown",t.endPullDown))}),100)},endPullDown:function(e){var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.translateY=0,t.pullDownStatus=1}),e||0)},prevent:function(e){this.translateY>0&&e.preventDefault()},scroll:function(e){var t=this;this.$emit("onScroll",e),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.scrolltolower(e)}),20)},scrolltolower:function(e){var t=this,n=uni.createSelectorQuery().in(this).select(".you-scroll-inner");n.fields({size:!0,scrollOffset:!0},(function(n){n.scrollTop>=e.detail.scrollHeight-n.height-t.reachBottomDistance&&t.$emit("onLoadMore",e)})).exec()},isWeixinCient:function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)}},mounted:function(){this.isWeixinCient()&&document.body.addEventListener("touchmove",this.prevent)},destroyed:function(){this.isWeixinCient()&&document.body.removeEventListener("touchmove",this.prevent)}};t.default=s}}]);