(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-evaluate"],{"069b":function(t,e,n){"use strict";n.r(e);var a=n("7e1d2"),i=n("cac8");for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("7f25");var o,u=n("f0c5"),s=Object(u["a"])(i["default"],a["b"],a["c"],!1,null,"61318d28",null,!1,a["a"],o);e["default"]=s.exports},"10b9":function(t,e,n){"use strict";n.r(e);var a=n("a8f2");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);var r,o,u,s,c=n("f0c5"),d=Object(c["a"])(a["default"],r,o,!1,null,null,null,!1,u,s);e["default"]=d.exports},"20b0":function(t,e,n){"use strict";var a=n("4ea4");n("d3b7"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("c1f4")),r=a(n("757a")),o={},u=function(t){var e=t.url,n=t.data,a=t.name,u=t.isFull,s=t.path_type;o["token"]="".concat(r.default.getters.cache_user_login_key),o["platform"]="".concat(r.default.getters.platform);var c=r.default.getters.cache_shop_user_info_key,d=c&&c["token"]?c["token"]:"",f="&application=app&application_client_type=weixin&ajax=ajax&token="+d+"&uuid="+r.default.getters.cache_user_uuid_key||!1,l=u?e:i.default+"/index.php?s="+e;return new Promise((function(t,e){uni.uploadFile({url:l+f,header:o,filePath:n,fileType:"image",formData:{action:"uploadimage",path_type:s},name:a}).then((function(n){var a="string"==typeof n[1].data?JSON.parse(n[1].data):n[1].data;if(!n[1].statusCode||200!=n[1].statusCode)throw e(a);if(0!=a["code"])throw a;t(a)})).catch((function(t){switch(t.code){case 401:uni.clearStorageSync();break;default:uni.showToast({title:t.msg,icon:"none"});break}}))}))},s=u;e.default=s},"42ac":function(t,e,n){"use strict";var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;a(n("31b2"));var i={data:function(){return{initLoading:0,loading:0}},watch:{loading:function(t,e){t>0?uni.showLoading({mask:!0,title:"加载中"}):uni.hideLoading()},initLoading:function(t,e){}},created:function(){},methods:{}};e.default=i},"7e1d2":function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.initLoading?t._e():n("v-uni-view",{staticClass:"content"},[t._l(t.sku_info,(function(e,a){return n("v-uni-view",{key:a,staticClass:"evaluate"},[n("v-uni-view",{staticClass:"evaluate-pro"},[n("v-uni-image",{staticClass:"goods-img",attrs:{src:e.imgs,mode:"aspectFill"}}),n("v-uni-view",{staticClass:"evaluate-stars flex1"},t._l(t.stars,(function(a,i){return n("v-uni-text",{key:i,staticClass:"iconfont icon-pingjiaxingxing evalate-icon",class:{active:i+1<=e.rating},attrs:{maxlength:"120"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.starsChange(e,i)}}})})),1)],1),n("v-uni-view",{staticClass:"evaluate-content"},[n("v-uni-text",{staticClass:"iconfont icon-tubiao09 edit"}),n("v-uni-view",{staticClass:"evaluate-textarea flex1"},[n("v-uni-textarea",{attrs:{"placeholder-style":"color: #A3A3A3;font-size:24upx;",placeholder:"商品满足你的期待吗？赶快跟大家分享一下你的使用心得吧～"},on:{blur:function(n){arguments[0]=n=t.$handleEvent(n),t.textAreaBlur(e,n)}}})],1)],1),n("v-uni-view",{staticClass:"evaluate-image"},[t._l(e.images,(function(a,i){return n("v-uni-view",{key:i,staticClass:"img-show"},[n("v-uni-image",{staticClass:"img",attrs:{src:a,mode:"aspectFill"}}),n("v-uni-text",{staticClass:"iconfont icon-guanbi close",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.imgDel(e,i)}}})],1)})),n("v-uni-image",{staticClass:"goods-img",attrs:{src:"/static/imgAdd.png",mode:"aspectFill"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.chooseImg(e)}}})],2)],1)})),n("v-uni-view",{staticClass:"mt20 ml40"},[n("v-uni-switch",{staticStyle:{transform:"scale(.8)"},attrs:{color:"#FE6167"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.switchChange.apply(void 0,arguments)}}}),n("v-uni-text",{staticStyle:{"font-size":"28upx",color:"#303133"}},[t._v("匿名(你的评论会以"+t._s(t.is_anonymous?"匿名":"昵称")+"的形式展示)")])],1),n("v-uni-button",{staticClass:"add-btn",class:{disabled:t.isLoading},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.confirm.apply(void 0,arguments)}}},[t._v("提交")])],2)},r=[]},"7f25":function(t,e,n){"use strict";var a=n("df45"),i=n.n(a);i.a},a623:function(t,e,n){"use strict";var a=n("23e7"),i=n("b727").every,r=n("a640"),o=n("ae40"),u=r("every"),s=o("every");a({target:"Array",proto:!0,forced:!u||!s},{every:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},a8f2:function(t,e,n){"use strict";n.r(e);var a=n("42ac"),i=n.n(a);for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=i.a},cac8:function(t,e,n){"use strict";n.r(e);var a=n("edab"),i=n.n(a);for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=i.a},d427:function(t,e,n){var a=n("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";\n/* 页面左右间距 */\n/*远素间距*/\n/* 文字尺寸 */\n/*文字颜色*/\n/* 边框颜色 */\n/* 图片加载中颜色 */\n/* 行为相关颜色 */uni-page-body[data-v-61318d28]{background:#f3f3f3;padding-bottom:%?140?%}body.?%PAGE?%[data-v-61318d28]{background:#f3f3f3}',""]),t.exports=e},df45:function(t,e,n){var a=n("d427");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=n("4f06").default;i("694a6bd0",a,!0,{sourceMap:!1,shadowMode:!1})},edab:function(t,e,n){"use strict";var a=n("4ea4");n("99af"),n("a623"),n("4160"),n("d81d"),n("a434"),n("498a"),n("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("96cf");var i=a(n("1da1")),r=a(n("5530")),o=a(n("9fc0")),u=n("b116"),s=a(n("20b0")),c=n("2f62"),d=a(n("10b9")),f={mixins:[d.default],components:{},data:function(){return{stars:[1,1,1,1,1],isLoading:!1,sku_info:[],order_id:"",is_anonymous:"",editor_path_type:""}},computed:(0,r.default)({},(0,c.mapGetters)(["pager"])),onLoad:function(t){var e=this;return(0,i.default)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.initLoadingFn((0,i.default)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.order_id?(e.order_id=t.order_id,e.orderProducts()):uni.redirectTo({url:"/pages/error/index"});case 1:case"end":return n.stop()}}),n)}))));case 1:case"end":return n.stop()}}),n)})))()},methods:{starsChange:function(t,e){t.rating=e+1},textAreaBlur:function(t,e){t.content=e.detail.value},chooseImg:function(t){var e=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(t.images.length>=3)){n.next=3;break}return e.$api.msg("最多支持上传3张图片！",2e3),n.abrupt("return");case 3:a=e,uni.chooseImage({count:3,sizeType:["compressed"],success:function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n.tempFilePaths.forEach(function(){var e=(0,i.default)(regeneratorRuntime.mark((function e(n){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.loadingFn((0,s.default)({url:"/api/ueditor/index",data:n,name:"upfile",path_type:a.editor_path_type}));case 2:i=e.sent,r=i.data,t.images=t.images.concat(r.url);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()});case 5:case"end":return n.stop()}}),n)})))()},imgDel:function(t,e){t.images.splice(e,1)},switchChange:function(t){this.is_anonymous=t.target.value},orderProducts:function(){var t=this;return(0,i.default)(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.loadingFn((0,o.default)("/api/order/comments","POST",{id:t.order_id}));case 2:n=e.sent,a=n.data,t.editor_path_type=a.editor_path_type,t.sku_info=a.data.items.map((function(t){return{imgs:t.images,goods_id:t.goods_id,content:"",images:[],rating:5}}));case 6:case"end":return e.stop()}}),e)})))()},confirm:function(){var t=this;return(0,i.default)(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.sku_info.every((function(t){return!(0,u.isEmpty)(t.content)&&t.content.trim().length>5&&t.content.trim().length<230})),n){e.next=4;break}return t.$api.msg("评论内容 6~230 个字符之间！",2e3),e.abrupt("return");case 4:return t.isLoading=!0,a={is_anonymous:t.is_anonymous?1:0,id:t.order_id,goods_id:JSON.stringify(t.sku_info.map((function(t){return t.goods_id}))),rating:JSON.stringify(t.sku_info.map((function(t){return t.rating}))),content:JSON.stringify(t.sku_info.map((function(t){return t.content}))),images:JSON.stringify(t.sku_info.map((function(t){return t.images})))},e.prev=6,e.next=9,t.loadingFn((0,o.default)("/api/order/commentssave","POST",a));case 9:t.$api.msg("评价提交成功！",2e3),t.$api.prePage().commandAction(),setTimeout((function(){uni.navigateBack()}),1e3),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](6),t.isLoading=!1;case 17:case"end":return e.stop()}}),e,null,[[6,14]])})))()}}};e.default=f}}]);